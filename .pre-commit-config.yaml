# ============================================================================
# Pre-commit Configuration for APPSIERRA
# ============================================================================
# Pre-commit is a framework for managing and maintaining multi-language
# pre-commit hooks. Install with: pip install pre-commit
# Setup: pre-commit install
# Run manually: pre-commit run --all-files
# Documentation: https://pre-commit.com/
# ============================================================================

# Pre-commit configuration version
default_language_version:
  python: python3.11

# Default stages to run hooks
default_stages: [commit, push]

# Fail fast on first error
fail_fast: false

# Minimum pre-commit version
minimum_pre_commit_version: "3.0.0"

# ============================================================================
# Repository Hooks
# ============================================================================

repos:
  # ---------------------------------------------------------------------------
  # Pre-commit built-in hooks
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # File checks
      - id: check-yaml
        name: Check YAML syntax
        description: Check for valid YAML syntax

      - id: check-json
        name: Check JSON syntax
        description: Check for valid JSON syntax

      - id: check-toml
        name: Check TOML syntax
        description: Check for valid TOML syntax

      - id: check-xml
        name: Check XML syntax
        description: Check for valid XML syntax

      - id: check-added-large-files
        name: Check for large files
        description: Prevent giant files from being committed (>500KB)
        args: ["--maxkb=500"]

      - id: check-case-conflict
        name: Check for case conflicts
        description: Check for files that would conflict in case-insensitive filesystems

      - id: check-merge-conflict
        name: Check for merge conflicts
        description: Check for files that contain merge conflict strings

      - id: detect-private-key
        name: Detect private keys
        description: Detect the presence of private keys

      # Python-specific checks
      - id: check-ast
        name: Check Python AST
        description: Check whether files parse as valid Python

      - id: check-builtin-literals
        name: Check builtin literals
        description: Require literal syntax when initializing empty or zero Python builtins

      - id: check-docstring-first
        name: Check docstring first
        description: Check that docstrings come before code

      - id: debug-statements
        name: Check for debug statements
        description: Check for debugger imports and py37+ breakpoint() calls

      - id: name-tests-test
        name: Check test naming
        description: Ensure test files are named test_*.py or *_test.py
        args: ["--pytest-test-first"]

      # File formatting
      - id: end-of-file-fixer
        name: Fix end of files
        description: Ensure files end with a newline

      - id: trailing-whitespace
        name: Trim trailing whitespace
        description: Trim trailing whitespace
        args: [--markdown-linebreak-ext=md]

      - id: mixed-line-ending
        name: Fix mixed line endings
        description: Replace or check mixed line ending
        args: ["--fix=lf"]

      - id: fix-byte-order-marker
        name: Remove UTF-8 BOM
        description: Remove UTF-8 byte order marker

  # ---------------------------------------------------------------------------
  # Ruff - Fast Python linter and formatter
  # ---------------------------------------------------------------------------
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.9
    hooks:
      # Run the linter
      - id: ruff
        name: Ruff linter
        description: Run ruff linter with auto-fix
        args: [--fix, --exit-non-zero-on-fix]
        types_or: [python, pyi]

      # Run the formatter
      - id: ruff-format
        name: Ruff formatter
        description: Run ruff formatter
        types_or: [python, pyi]

  # ---------------------------------------------------------------------------
  # Mypy - Static type checker
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        name: Mypy type checker
        description: Run mypy static type checker
        args: [--config-file=pyproject.toml]
        # Exclude test files for faster checks
        exclude: ^tests/

  # ---------------------------------------------------------------------------
  # Codespell - Check for common misspellings
  # ---------------------------------------------------------------------------
  - repo: https://github.com/codespell-project/codespell
    rev: v2.2.6
    hooks:
      - id: codespell
        name: Check spelling
        description: Check for common misspellings in text files
        args:
          - --skip=*.json,*.jsonl,*.lock,.git,.venv,venv,__pycache__,*.pyc,logs/*
          - --ignore-words-list=crate,aNULL,te,nd,unexpect

  # ---------------------------------------------------------------------------
  # Markdown linting
  # ---------------------------------------------------------------------------
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.39.0
    hooks:
      - id: markdownlint
        name: Markdown linting
        description: Lint markdown files
        args: [--fix]

  # ---------------------------------------------------------------------------
  # Prettier - Format various file types
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        name: Format with Prettier
        description: Format JSON, YAML, Markdown, and other files
        types_or: [json, yaml, markdown, toml]
        exclude: ^(\.venv/|venv/|\.git/)

  # ---------------------------------------------------------------------------
  # Check Python requirements files
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pygrep-hooks
    rev: v1.10.0
    hooks:
      - id: python-check-blanket-noqa
        name: Check blanket noqa
        description: Enforce that noqa annotations always specify specific codes

      - id: python-check-blanket-type-ignore
        name: Check blanket type ignore
        description: Enforce that # type: ignore annotations specify specific codes

      - id: python-no-eval
        name: No eval()
        description: A quick check for the eval() built-in function

      - id: python-no-log-warn
        name: No log.warn()
        description: A quick check for deprecated .warn() method of python loggers

      - id: python-use-type-annotations
        name: Use type annotations
        description: Enforce that type annotations are used instead of type comments

      - id: text-unicode-replacement-char
        name: Check for unicode replacement characters
        description: Detect the presence of unicode replacement characters

# ============================================================================
# CI Configuration
# ============================================================================
ci:
  # Frequency to run pre-commit.ci auto-updates
  autoupdate_schedule: weekly

  # Skip these hooks in CI
  skip: []

  # Commit message for auto-fixes
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci

  # PR title for version updates
  autoupdate_commit_msg: |
    [pre-commit.ci] pre-commit autoupdate
